@model Optica_Gaido.Models.ViewModels.Sales.NewViewModel

@{
    ViewData["Title"] = "Nueva venta";
}

<!-- Styles -->
<link href="~/lib/datatables/media/css/dataTables.bootstrap4.css" rel="stylesheet" />
<link href="~/lib/icheck/skins/all.css" rel="stylesheet" />
<link href="~/lib/wizard/steps.css" rel="stylesheet" />


<!-- This is data table -->
<script src="~/lib/datatables/datatables.min.js"></script>

<!-- icheck -->
<script src="~/lib/icheck/icheck.min.js"></script>
<script src="~/lib/icheck/icheck.init.js"></script>

<!-- Steps -->
<script src="~/lib/wizard/jquery.steps.min.js"></script>
@*<script src="~/lib/wizard/steps.js"></script>*@
<div class="container-fluid">
    <!-- ============================================================== -->
    <!-- Bread crumb and right sidebar toggle -->
    <!-- ============================================================== -->
    <div class="row page-titles">
        <div class="col-md-5 col-8 align-self-center">
            <h3 class="text-themecolor m-b-0 m-t-0">Ventas</h3>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a asp-area="" asp-controller="Home" asp-action="Index">Inicio</a></li>
                <li class="breadcrumb-item"><a asp-area="" asp-controller="Sales" asp-action="Index">Ventas</a></li>
                <li class="breadcrumb-item active">Nueva</li>
            </ol>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- End Bread crumb and right sidebar toggle -->
    <!-- ============================================================== -->
    <!-- ============================================================== -->
    <!-- Start Page Content -->
    <!-- ============================================================== -->
    <!-- Modal -->
    <div id="modalCreate" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
        <div id="formContainer" class="modal-dialog">
            <form role="form" class="" method="POST" asp-area="" asp-controller="Sales" asp-action="Create" id="form-create" autocomplete="off">
                <input type="hidden" name="CreateViewModel.ID" value="" />
                @Html.AntiForgeryToken()
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 id="modalTitle" class="modal-title"></h4>
                        <button type="button" class="close" id="btnCloseModalCreate" data-dismiss="modal" aria-hidden="true">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="form-column">
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Cerrar</button>
                        <button id="btnSendModal" type="submit" class="btn btn-success waves-effect waves-light">Agregar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- End Modal -->


    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body wizard-content">
                    <h4 class="card-title">Nueva venta</h4>
                    <h6 class="card-subtitle mb-0">@DateTime.UtcNow.AddHours(-3).ToString("dd/MM/yyyy")</h6>
                    <form asp-area="" asp-controller="Sales" asp-action="Create" class="tab-wizard wizard-circle">
                        <!-- Step 1 -->
                        <h6>Cliente</h6>
                        <section>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="form-body">
                                        <h3 class="box-title">Datos</h3>
                                        <hr class="m-t-0 m-b-20">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group row">
                                                    <label class="control-label text-md-right col-5">Nombre:</label>
                                                    <div class="col-7 pr-0">
                                                        <p class="form-control-static">@Html.DisplayFor(x => x.Client.Name)</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                            <div class="col-md-6">
                                                <div class="form-group row">
                                                    <label class="control-label text-md-right col-5">Apellido:</label>
                                                    <div class="col-7 pr-0">
                                                        <p class="form-control-static">@Html.DisplayFor(x => x.Client.Surname)</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                        </div>
                                        <!--/row-->
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group row">
                                                    <label class="control-label text-md-right col-5">Teléfono:</label>
                                                    <div class="col-7 pr-0">
                                                        <p class="form-control-static">@Html.DisplayFor(x => x.Client.Phone)</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                            <div class="col-md-6">
                                                <div class="form-group row">
                                                    <label class="control-label text-md-right col-5">Dirección:</label>
                                                    <div class="col-7 pr-0">
                                                        <p class="form-control-static">@Html.DisplayFor(x => x.Client.Adress)</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                        </div>
                                        <!--/row-->
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group row">
                                                    <label class="control-label text-md-right col-5">@(Model.Client.Debt >= 0 ? "Deuda" : "Saldo a favor:")</label>
                                                    <div class="col-7 pr-0">
                                                        <p class="form-control-static">$@(Model.Client.Debt >= 0 ? Model.Client.Debt : (-Model.Client.Debt).ToString("0.00"))</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                            <div class="col-md-6">
                                                <div class="form-group row">
                                                    <label class="control-label text-md-right col-5">Obra social:</label>
                                                    <div class="col-7 pr-0">
                                                        <p class="form-control-static">@Html.DisplayFor(x => x.Client.HealthInsurance.Name)</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--/span-->
                                        </div>
                                        <!--/row-->
                                    </div>
                                </div>
                            </div>
                        </section>
                        <!-- Step 2 -->
                        <h6>Datos</h6>
                        <section>
                            <div class="row col-12 m-0 p-0">

                                <!-- Precio -->
                                <div class="col-12 col-sm-6 col-lg-3 col-xxl-3 mb-3">
                                    <label asp-for="CreateViewModel.Price" class="mb-0"></label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                        </div>
                                        <input asp-for="CreateViewModel.Price" class="form-control" type="number" data-val-number="Debes ingresar un número" />
                                    </div>
                                </div>

                                <!-- Seña -->
                                <div class="col-12 col-sm-6 col-lg-3 col-xxl-3 mb-3">
                                    <label asp-for="CreateViewModel.Deposit" class="mb-0"></label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                        </div>
                                        <input asp-for="CreateViewModel.Deposit" class="form-control" type="number" data-val-number="Debes ingresar un número" />
                                    </div>
                                </div>

                                <!-- Tipo -->
                                <div class="col-6 col-lg-3 col-xxl-2 mb-3 d-flex justify-content-center align-items-center">
                                    <ul class="icheck-list p-0">
                                        @foreach (var item in Model.GlassTypes)
                                        {
                                            <li>
                                                <input type="radio" asp-for="CreateViewModel.GlassTypeID" value="@item.ID" id="type_@(item.ID)" class="check" data-radio="iradio_square-purple" />
                                                <label for="type_@item.ID" class="mb-0">@item.Name</label>
                                            </li>
                                        }
                                    </ul>
                                </div>

                                <!-- AR -->
                                <div class="col-6 col-lg-3 col-xxl-2 mb-3 d-flex justify-content-center align-items-center">
                                    <input asp-for="CreateViewModel.IsAr" class="" />
                                    <label asp-for="CreateViewModel.IsAr" class="mb-0"></label>
                                </div>

                                <!-- Altura película -->
                                <div class="col-12 col-sm-6 col-lg-4 col-xl-4 col-xxl-2 mb-3">
                                    <label asp-for="CreateViewModel.MovieHeight" class="mb-0"></label>
                                    <div class="input-group">
                                        <input asp-for="CreateViewModel.MovieHeight" class="form-control" type="number" data-val-number="Debes ingresar un número" />
                                        <div class="input-group-prepend">
                                            <span class="input-group-text py-0 px-1">mm</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Color -->
                                <div class="col-12 col-sm-6 col-lg-4 col-xxl-3 mb-3">
                                    <label asp-for="CreateViewModel.GlassColorID" class="mb-0"></label>
                                    @Html.DropDownListFor(x => x.CreateViewModel.GlassColorID, Model.GlassColors, null, new { @class = "form-control" })
                                </div>

                                <!-- DIP -->
                                <div class="col-12 col-sm-6 col-lg-4 col-xxl-3 mb-3">
                                    <label asp-for="CreateViewModel.Dip" class="mb-0"></label>
                                    <input asp-for="CreateViewModel.Dip" class="form-control" />
                                    <span asp-validation-for="CreateViewModel.Dip" class="text-danger"></span>
                                </div>

                                <!-- Vendedor -->
                                <div class="col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-3 mb-3">
                                    <label asp-for="CreateViewModel.SellerID" class="mb-0"></label>
                                    @Html.DropDownListFor(x => x.CreateViewModel.SellerID, Model.Sellers, null, new { @class = "form-control" })
                                    <span asp-validation-for="CreateViewModel.SellerID" class="text-danger"></span>
                                </div>

                                <!-- Doctor -->
                                <div class="col-12 col-md-6 col-lg-6 col-xxl-3 mb-3">
                                    <label asp-for="CreateViewModel.DoctorID" class="mb-0"></label>
                                    @Html.DropDownListFor(x => x.CreateViewModel.DoctorID, Model.Doctors, null, new { @class = "form-control" })
                                    <span asp-validation-for="CreateViewModel.DoctorID" class="text-danger"></span>
                                </div>
                            </div>
                        </section>
                        <!-- Step 3 -->
                        <h6>Formato del material</h6>
                        <section>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="int1">Interview For :</label>
                                        <input type="text" class="form-control" id="int1">
                                    </div>
                                    <div class="form-group">
                                        <label for="intType1">Interview Type :</label>
                                        <select class="custom-select form-control" id="intType1" data-placeholder="Type to search cities" name="intType1">
                                            <option value="Banquet">Normal</option>
                                            <option value="Fund Raiser">Difficult</option>
                                            <option value="Dinner Party">Hard</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="Location1">Location :</label>
                                        <select class="custom-select form-control" id="Location1" name="location">
                                            <option value="">Select City</option>
                                            <option value="India">India</option>
                                            <option value="USA">USA</option>
                                            <option value="Dubai">Dubai</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="jobTitle2">Interview Date :</label>
                                        <input type="date" class="form-control" id="jobTitle2">
                                    </div>
                                    <div class="form-group">
                                        <label>Requirements :</label>
                                        <div class="c-inputs-stacked">
                                            <div class="m-b-10">
                                                <label class="custom-control custom-radio">
                                                    <input id="radio1" name="radio" type="radio" class="custom-control-input">
                                                    <span class="custom-control-label">Employee</span>
                                                </label>
                                                <label class="custom-control custom-radio">
                                                    <input id="radio2" name="radio" type="radio" class="custom-control-input">
                                                    <span class="custom-control-label">Contract</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <!-- Step 4 -->
                        <h6>Métodos de pago</h6>
                        <section>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="behName1">Behaviour :</label>
                                        <input type="text" class="form-control" id="behName1">
                                    </div>
                                    <div class="form-group">
                                        <label for="participants1">Confidance</label>
                                        <input type="text" class="form-control" id="participants1">
                                    </div>
                                    <div class="form-group">
                                        <label for="participants1">Result</label>
                                        <select class="custom-select form-control" id="participants1" name="location">
                                            <option value="">Select Result</option>
                                            <option value="Selected">Selected</option>
                                            <option value="Rejected">Rejected</option>
                                            <option value="Call Second-time">Call Second-time</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="decisions1">Comments</label>
                                        <textarea name="decisions" id="decisions1" rows="4" class="form-control"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>Rate Interviwer :</label>
                                        <div class="c-inputs-stacked">
                                            <label class="inline custom-control custom-checkbox block">
                                                <input type="checkbox" class="custom-control-input">
                                                <span class="custom-control-label ml-0">1 star</span>
                                            </label>
                                            <label class="inline custom-control custom-checkbox block">
                                                <input type="checkbox" class="custom-control-input">
                                                <span class="custom-control-label ml-0">2 star</span>
                                            </label>
                                            <label class="inline custom-control custom-checkbox block">
                                                <input type="checkbox" class="custom-control-input">
                                                <span class="custom-control-label ml-0">3 star</span>
                                            </label>
                                            <label class="inline custom-control custom-checkbox block">
                                                <input type="checkbox" class="custom-control-input">
                                                <span class="custom-control-label ml-0">4 star</span>
                                            </label>
                                            <label class="inline custom-control custom-checkbox block">
                                                <input type="checkbox" class="custom-control-input">
                                                <span class="custom-control-label ml-0">5 star</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    $(".tab-wizard").steps({
        headerTag: "h6"
        , bodyTag: "section"
        , transitionEffect: "fade"
        , titleTemplate: '<span class="step">#index#</span> #title#'
        , labels: {
            cancel: "Cancelar",
            next: "Siguiente",
            previous: "Anterior",
            finish: "Vender",
        }
        , onFinished: function (event, currentIndex) {
            swal("Form Submitted!", "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed lorem erat eleifend ex semper, lobortis purus sed.");
        }
    });
</script>

<script>
    $('form select').each(function () {
        $(this).val($(this).find('option:first').val());
    });

    function sendForm(action) {
        let form = document.getElementById(`form-${action}`);

        let errors = $(".input-validation-error");

        if (errors.length === 0) {
            // Enviar solicitud AJAX
            $.ajax({
                url: $(form).attr('action'), // Utiliza la ruta del formulario
                method: $(form).attr('method'), // Utiliza el método del formulario
                data: $(form).serialize(), // Utiliza los datos del formulario
                success: function (response) {
                    Swal.fire({
                        icon: 'success',
                        title: response.message,
                        confirmButtonColor: '#1e88e5',
                    });
                    $("#btnCloseModalCreate").click();
                    if (action === 'create') {
                        fillTable(response.data);
                    } else if (action === 'edit') {
                        fillTable(response.data);
                        removeFromTable(response.data.id);
                    } else {
                        removeFromTable(response.data);
                    }
                },
                error: function (errorThrown) {
                    Swal.fire({
                        icon: 'error',
                        title: errorThrown.responseJSON.title,
                        text: errorThrown.responseJSON.message,
                        confirmButtonColor: '#1e88e5',
                    });
                }
            });
        }
    }
</script>

<script>
    $("#btnAdd").on("click", function () {
        $("#modalTitle").text("Agregar marco");
        $("#formContainer form").attr("action", "/Sales/Create");
        $("#formContainer form").attr("id", "form-create");
        $("#formContainer form input:not([type='hidden']").val("");
        $("input[name='CreateViewModel.ID']").prop("disabled", true);
        $('#formContainer form select').each(function () {
            $(this).val($(this).find('option:first').val());
        });
        $("#btnSendModal").text("Agregar");

        $("#form-create").on("submit", function (e) {
            e.preventDefault();
            sendForm("create");
        })
    });

    $('#DataTable').DataTable({
        "language": {
            "sInfo": "Mostrando _START_ a _END_ de _TOTAL_ marcos",
            "sInfoEmpty": "Mostrando 0 a 0 de 0 marcos",
            "sInfoFiltered": "(filtrado de _MAX_ marcos en total)",
            "emptyTable": 'No hay marcos que coincidan con la búsqueda',
            "sLengthMenu": "Mostrar _MENU_ marcos",
            "sSearch": "Buscar:",
            "oPaginate": {
                "sFirst": "Primero",
                "sLast": "Último",
                "sNext": "Siguiente",
                "sPrevious": "Anterior",
            },
        },
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>